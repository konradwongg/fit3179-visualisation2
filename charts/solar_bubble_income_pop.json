{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Population vs Total Solar Installations",
  "data": {
    "url": "data/solar_top_postcodes.csv",
    "format": {
      "type": "csv",
      "parse": {
        "Population": "number",
        "TotalInstallations": "number",
        "InstallationsPer1000": "number",
        "MedianIncome": "number"
      }
    }
  },
  "transform": [
    { "calculate": "isValid(datum.TotalInstallations) ? datum.TotalInstallations : (isValid(datum.Total) ? toNumber(datum.Total) : (isValid(datum.total) ? toNumber(datum.total) : 0))", "as": "tot" },
    { "calculate": "isValid(datum.Population) ? datum.Population : (isValid(datum.population) ? toNumber(datum.population) : 0)", "as": "pop" }
  ],
  "width": 560,
  "height": 360,
  "mark": { "type": "circle", "opacity": 0.7, "stroke": "white", "strokeWidth": 0.6 },
  "encoding": {
    "x": { "field": "pop", "type": "quantitative", "title": "Population" },
    "y": { "field": "tot", "type": "quantitative", "title": "Total installations" },
    "size": { "field": "tot", "type": "quantitative", "legend": { "title": "Total installs" }, "scale": { "range": [20, 600] } },
    "color": {
      "field": "State",
      "type": "nominal",
      "title": "State",
      "scale": {
        "domain": ["NSW","VIC","QLD","SA","WA","TAS","NT","ACT"],
        "range":  ["#1565C0","#2E7D32","#F9A825","#7B1FA2","#00897B","#EF6C00","#8E24AA","#455A64"]
      }
    },
    "tooltip": [
      { "field": "Postcode", "title": "Postcode" },
      { "field": "State", "title": "State" },
      { "field": "Population", "title": "Population", "format": ",.0f" },
      { "field": "TotalInstallations", "title": "Total installs", "format": ",.0f" }
    ]
  }
}
